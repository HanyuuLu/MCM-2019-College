1. 聚类方法   
   1. K-means   
   
   	step 1`:`从数据集中随机选取K个样本作为初始聚类的中心$C={c_1,c_2,...,c_k}$   
   	step 2:针对数据集中每个样本$x_i$,计算它到K个聚类中心的距离并将其分到距离最小的聚类中心所对应的类中   
   	step 3:针对每个类别$c_i$，重新计算它的聚类中心$c_i=\frac{1}{\left|c_i\right|}\sum_{x \in c_i}x$(即属于该类的所有样本的质心)   
   	step 4:重复第二步和第三步直到聚类中心的位置不再变化   
   
   2. K-means++   
   	
   	step 1:从数据集中随机选取一个样本作为初始聚类的中心$c_i$;  
   	
   	step 2:首先计算每个样本与当前已有聚类中心之间的最短距离(即与最近的一个聚类中心的距离)，用$D(x)$表示;接着计算每个样本被选为下一个聚类中心的概率$\frac{D(x)^2}{\sum_{x\in X}D(x)^2}$。最后按照轮盘法选择出下一个聚类的中心  
   	
   	step 3:重复第二步直到选择出K个聚类中心
   
2. 数据错误以处理   

	1. 由于2月份以后没有MetroNum、BusNum、BusMetroNum三个类型数据的信息，所以这里我们需要自行统计
	2. 数据错误：有些用户记录的 BusNum+MetroNum!=BusMetroNum、乘车日期和时间的丢失、支付类型的丢失、乘车记录的丢失（当前有乘车当时没有记录）
	3. 重复记录（导致错误的挖掘模式，遍历的时候判断？SNM方法）
	4. 针对PAYTYPE的Null数值，鉴于我们数据的统计了每个人PAYTYPE 0与1的数量，我们可以根据相应的概率把Null值改为0或1中的某个值。时间填充方面可以划分24小时的乘车区间，根据相应乘车区间的数量，算出在每一区间乘车的概率，根据概率向Uptime和LastTime中填入数据
	5. 数据特征：每个月选取的数据都是一个星期内考虑了双休日的情况，所以数据给出的是比较合理的
	6. 针对乘车日期的缺失：假如一个用户当天多次乘车，上一次乘车UpTime丢失，判断是否可以用下一次乘车的LastTime补充

3. 支付特征提取（认为公交车和地铁为同一种类型）

	1. 综合考虑2、4、8、11月共4周情况，综合分析星期i的交易量，移动的交易占比（计算每天的平均交易量和移动支付交易量，两者相除得出占比），人均交易数（当天交易量除以当天的乘车人数）。   
	2. 针对4个月中，每个月统计的那一周的线上支付占比（根据算出每月的线上支付占比，判断是否存在使用线上支付的人数越来越多的情况）。   
	3. 根据4周的数据，分析一个人是否从不使用移动支付变为开始使用移动支付（新增用户）
	4. 分析各个时间段，移动支付的交易量和占比，支付量占全天支付量的百分比
	5. 分别分析工作日和双休日，公交的成交量和移动支付的占比
	6. 根据个人总乘车次数与相应的移动支付占比，分析移动支付占比也乘车次数之前的关系
	7. 根据聚类结果，分析每个聚类的支付情况和特征

4. 数学符号   

|符号|说明|
|----|----|
|$SumCharge$|所有天数的公共交通支付笔数数目的总和|
|$SumCharge^{MobilePay}$|所有天数移动支付公共交通的成交量|
|$MonthlyCharge_i$|第$i$月一周的公共交通支付数目的总和|
|$MonthlyCharge^{MobilePay}_i$|第$i$月移动支付公共交通的笔数|
|$DailyCharge_{(i,j)}$|第$i$月星期$j$的公共交通支付数目|
|$DailyCharge^{MobilePay}_{(i,j)}$|第i月星期j当天移动支付公共交通的笔数|
|$\overline {times}$|人均乘车次数|
|$\overline {times_i}$|第$i$月人均乘车次数|
|$\overline {times}_{(i,j)}$|第$i$月星期$j$的人均乘车次数|
|$\overline {times}^{mobilePay}_{(i,j)}$|第$i$月星期$j$的人均移动支付公共交通笔数|
|$Charge_{(i,j)}$|时间段i~j内,公共交通的支付量|
|$Charge_{(i,j)}^{mobilePay}$|时间段$i$~$j$内，移动支付公共交通的笔数|
|$Uptime_{m}^{i}$|乘客$m$在时间段$i\sim i+1$的乘车数量, $0\leq i \leq 23$|
|$P_m(i)$|乘客$m$在时间段$i\sim i+1$,乘车的概率|
|$CustomerSum(i)$|乘客$i$乘车总量|
|$CustomerSum(i)^{mobilePay}$|乘客$i$移动支付的数量|
1. 需要计算的数据：

	- 每天的移动支付数量  
	- 每天的总支付数量
	- 每天的人数（ID去重）
	- 每天早高峰：7-9的移动支付数量与总支付数量
	- 每天晚高峰17-19的移动支付数量与总支付数量

7. 特征提取实现：

	1. 对于每天的移动支付占比，绘制：

		散点图（按星期几排列）

		柱状图（按日期排列）

		饼状图（反应平均占比）
## 遍历结果
1. 第一次遍历Excel表(不进行数据清理)
   * 输入
     * ID
     * PayType
     * Uptime 
   * 数据处理
     * 数据清洗
       * 对于乘车类型为NULL的值，直接改为$0$表示移动支付
       * 对于Uptime错误的数据
         * 如果该乘客相邻两次记录中，上一次的Uptime丢失，而下一次的乘车记录给出了LastTime，则我们使用下一次记录的LastTtime填充上一次记录的UpTime，否则按如下步骤填充
           * 注意这个上下次记录只有同一个月的相邻记录有效，不同月的相邻记录无效  
         * 统计该乘客历史乘车记录 
          $$P_m(i)=\frac{Uptime_{m}^{i}}{\sum_{k=0}^{\infty}Uptime_{m}^{k}}$$
		 * 根据$P_m(i)$给出乘车区间$i\sim i+1$的乘车概率，根据$P_m(i)$的值选择相应乘车区间的中间值乘积$i+\frac{1}{2}$，填充乘车日期的错误值 
	* 数据清理
    	* 删除乘车次数$CustomerSum \leq 2$) 的数据，直接把这个数据从哈希表里删除
   * 输出
     * 间表格

